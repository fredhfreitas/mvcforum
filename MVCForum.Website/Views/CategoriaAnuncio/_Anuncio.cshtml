@using MvcForum.Web.Application.ExtensionMethods
@model MvcForum.Web.ViewModels.Topic.TopicViewModel
@using System.Text.RegularExpressions;
@{
    var postToolTip = Model.Topic.Name;
}
@if (!Model.Permissions[ForumConfiguration.Instance.PermissionDenyAccess].IsTicked)
{
    <div class="col-md-12">
        <div class="topic-item side topicrow topicsticky-@(Model.Topic.IsSticky.ToString().ToLower()) topiclocked-@(Model.Topic.IsLocked.ToString().ToLower()) topicsolved-@(Model.Topic.Solved.ToString().ToLower())">

            @if (Regex.Match(Model.Topic.Posts.FirstOrDefault().PostContent, @"(<img([^>]+)>)").Success)
            {
                <div class="topic-image">
                    <a title="@postToolTip" href="@Html.Raw(Model.Topic.NiceUrl)">
                        @Html.Raw((Regex.Match(Model.Topic.Posts.FirstOrDefault().PostContent, @"(<img([^>]+)>)").Value))
                    </a>
                </div>
            }
            else
            {
                <div class="topic-image text-image">
                    <a title="@postToolTip" href="@Html.Raw(Model.Topic.NiceUrl)">@Html.Raw(Model.Topic.Name)</a>
                </div>
            }
            <!-- ./ topic-image -->

            <div class="topic-title">
                <h4>
                    <a title="@postToolTip" href="@Html.Raw(Model.Topic.NiceUrl)">
                        @Html.Raw(Model.Topic.Name)
                    </a>
                </h4>
            </div>
            <!-- ./ topic-title -->

            <div class="topic-info-actions">
                <div class="name-date">
                    <p>
                        <a href="@Model.Topic.LastPost.User.NiceUrl">@Model.Topic.LastPost.User.UserName</a> | <span>@DatesUi.GetPrettyDate(Model.Topic.LastPost.DateCreated.ToString()).</span>
                    </p>
                </div>
                <div class="view-comment">
                    <span class="stats topicviews"><i class="far fa-eye"></i> @Model.Views.KiloFormat()</span>
                    <span class="stats topicanswers"><i class="far fa-comment-alt"></i> @Model.Answers.KiloFormat()</span>
                </div>
            </div>
            <!-- ./ topic-info-actions -->

        </div>
    </div>
}